### Docker了解一下

听说过Docker的同学看到今天的标题可能会觉得奇怪，Docker和我们前端有什么关系呢，不是后端的事吗？这只能证明你还不了解Docker，作为当前最流行的容器化解决方案，Docker在我们的开发和部署中都能起到重大作用，和语言无关。

现如今前端项目基本上都离不开Node.js，比如我们开发了一个Vue.js项目，可以通过下面的命令启动开发服务器

```
npm run dev
```

然后再部署的时候

```
npm run build
```

这就意味着，我们需要在自己的本地开发环境和运行服务器中安装Node.js。然而，Node.js是有版本区分的，老项目运行的Node.js版本和新项目很可能不一样，那么问题就来了，如果我需要在自己的电脑上同时维护新旧两个项目，那就必须同时安装两个版本的Node.js。

如何实现呢？你可能需要根据自己的安装方式来切换不同的版本，而且一些npm包可能需要重新安装，总之就是很麻烦。

究竟有没有可能在同一台服务器上面同时安装两个不同版本的Node.js呢？试想一下，如果能实现，那么必须有一个隔离的环境来保证这两者之间互不干扰，每个环境都是一个能够完全独立运行的，直白说就是，一个服务器中运行了多个小服务器，那么这正是Docker干的事。

还有一个非常重要的问题就是，代码在本机运行得好好的，一到线上去了就各种问题，本质在于线上线下的环境不一致，那么Docker的出现也解决了这个问题，因为我们现在不光可以上传源码，环境也可以一起打包上传了。

**关于Docker**

Docker的核心概念有两个：镜像和容器。你可以这样理解，镜像就是一个操作系统，是静态的，而容器是运行这个操作系统的进程，他俩之间的关系就像类和实例一样。

镜像可以存储在本地宿主机和远程的仓库中，类似于GitHub存储了很多源代码，Docker官方也提供了这样一个仓库来存放公开的镜像，以`[用户名][镜像名]`的方式指定唯一地址。

**基于Docker的开发环境**

我们要实现的最终开发环境就是，在本地编写代码，也就是源码文件还在本机，实际的运行环境是在容器中。而Docker容器恰好是允许将宿主机的文件挂在到容器中的。

接下来我们来了解一下，如何在开发环境中使用Docker，我们需要做的是

* 1、安装Docker
* 2、生成镜像
* 3、基于该镜像运行一个容器并把源码文件夹挂载进去
* 4、进入容器并执行开发命令

**1、安装Docker**

前端的开发环境比较多，有Windows，有Mac，也有使用虚拟机安装的Linux系统，Docker支持的系统安装环境还是很多的，不过有些确实不支持。具体的要求和安装过程请查看官网，写得很清楚。

**2、生成镜像**

我们可以在Docker官方的镜像仓库[https://hub.docker.com/](https://hub.docker.com/)中搜索`node`找到我们需要的基础镜像和版本，然后在项目文件夹中新建一个名为Dockerfile的文件

```
FROM node:8.11
RUN npm install -g cnpm --registry=https://registry.npm.taobao.org

WORKDIR /www

CMD top -b
```

`FROM`表示基于哪个基础镜像

`RUN`表示要执行的一些命令，比如我们这里安装了`cnpm`，那么在启动容器的时候就能直接使用`cnpm install`命令了

`WORKDIR`设置工作目录

`CMD`启动容器的时候要执行的命令，这里我们给了一个没有意义的命令，目的只是为了保持容器在后台一直运行

然后基于该Dockerfile构建一个镜像

```
docker build -t app .
```

`-t`表示要生成的镜像名字（版本默认为latest）

完成后可以通过下面的命令看到该镜像

```
docker images
```

这一步实际上就是对基础镜像进行了一些定制，生成我们需要的新镜像。

**3、运行容器**

```
docker run -d -p 3000:8080 -v /root/app:/www app
```

`-d`表示在后台运行该容器，因为我可能想让容器一直存在，并且不干扰我做其他事，需要的时候再进入容器

`-p`表示将本机的3000端口映射到容器的8080端口，因为`npm run dev`一般会以8080端口启动一个服务，于是我们实际上需要访问的地址是`127.0.0.1:3000`

`-v`表示将本机源码所在文件夹`/root/app`挂载到容器的`/www`目录下

启动成功后可以通过下面的命令看到运行中的容器

```
docker ps
```

**4、进入容器**

通过下面的命令可以进入到容器中

```
docker exec -it <容器ID> /bin/bash
```

可以发现我们已经进入到容器的`/www`目录下了，然后`ls`可以看到宿主机中的文件都被挂载进来了。

接下来就可以执行`npm run dev`启动开发服务器，然后在浏览器中访问

```
http://127.0.0.1:3000
```

第二天要继续开发怎么办？很简单，不需要再通过`docker run`运行容器了，如果之前的容器停止了，直接通过下面的命令重新启动

```
docker start <容器ID>
```

当然如果发现容器被搞坏了，再走一遍上面的过程即可，这也是容器很爽的点，随时可以删掉容器，随时可以运行一个新的容器，非常方便。

**总结**

今天只是大致介绍了一下前端开发如何搭建一个基于Docker的容器开发环境，感兴趣的同学可以试试。如果有必要的话，后面会再将一期基于Docker的部署。因为Docker的重要优势之一就是可以保证开发环境和运行环境的一致。

>生命不息，折腾不止，每个前端开发者都不应该把自己局限于HTML和CSS，了解整个开发和部署是很有必要的。